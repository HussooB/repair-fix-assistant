
//#region src/store/modules/ttl-manager.ts
/**
* Handles TTL (Time-To-Live) operations: expiration, cleanup, sweeping.
*/
var TTLManager = class {
	sweepInterval;
	constructor(core) {
		this.core = core;
	}
	start() {
		if (this.sweepInterval) return;
		const intervalMs = (this.core.ttlConfig?.sweepIntervalMinutes || 60) * 60 * 1e3;
		this.sweepInterval = setInterval(() => {
			this.sweepExpiredItems().catch((error) => {
				console.error("Error during TTL sweep:", error);
			});
		}, intervalMs);
	}
	stop() {
		if (this.sweepInterval) {
			clearInterval(this.sweepInterval);
			this.sweepInterval = void 0;
		}
	}
	async sweepExpiredItems() {
		return this.core.withClient(async (client) => {
			const result = await client.query(`
        DELETE FROM ${this.core.schema}.store 
        WHERE expires_at IS NOT NULL AND expires_at <= CURRENT_TIMESTAMP
      `);
			return result.rowCount || 0;
		});
	}
};

//#endregion
exports.TTLManager = TTLManager;
//# sourceMappingURL=ttl-manager.cjs.map