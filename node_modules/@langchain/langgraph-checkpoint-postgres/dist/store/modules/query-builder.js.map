{"version":3,"file":"query-builder.js","names":["conditions: string[]"],"sources":["../../../src/store/modules/query-builder.ts"],"sourcesContent":["/**\n * Shared query building logic for CRUD and search operations.\n */\nexport class QueryBuilder {\n  static buildFilterConditions(\n    filter: Record<string, unknown>,\n    params: unknown[],\n    paramIndex: number\n  ): { conditions: string[]; newParamIndex: number } {\n    const conditions: string[] = [];\n    let currentParamIndex = paramIndex;\n\n    for (const [key, value] of Object.entries(filter)) {\n      if (\n        typeof value === \"object\" &&\n        value !== null &&\n        !Array.isArray(value)\n      ) {\n        const operators = Object.keys(value);\n        const isOperatorObject = operators.some((op) => op.startsWith(\"$\"));\n\n        if (isOperatorObject) {\n          // Handle advanced operators\n          for (const [operator, operatorValue] of Object.entries(value)) {\n            const result = this.buildOperatorCondition(\n              key,\n              operator,\n              operatorValue,\n              params,\n              currentParamIndex\n            );\n            if (result.condition) {\n              conditions.push(result.condition);\n              currentParamIndex = result.newParamIndex;\n            }\n          }\n        } else {\n          // Handle nested object queries\n          conditions.push(`value @> $${currentParamIndex}::jsonb`);\n          params.push(JSON.stringify({ [key]: value }));\n          currentParamIndex += 1;\n        }\n      } else {\n        // Handle simple value queries\n        conditions.push(\n          `value ->> $${currentParamIndex} = $${currentParamIndex + 1}`\n        );\n        params.push(key, String(value));\n        currentParamIndex += 2;\n      }\n    }\n\n    return { conditions, newParamIndex: currentParamIndex };\n  }\n\n  private static buildOperatorCondition(\n    key: string,\n    operator: string,\n    operatorValue: unknown,\n    params: unknown[],\n    paramIndex: number\n  ): { condition?: string; newParamIndex: number } {\n    switch (operator) {\n      case \"$eq\":\n        params.push(key, String(operatorValue));\n        return {\n          condition: `value ->> $${paramIndex} = $${paramIndex + 1}`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$ne\":\n        params.push(key, String(operatorValue));\n        return {\n          condition: `value ->> $${paramIndex} != $${paramIndex + 1}`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$gt\":\n        params.push(key, operatorValue);\n        return {\n          condition: `(value ->> $${paramIndex})::numeric > $${paramIndex + 1}`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$gte\":\n        params.push(key, operatorValue);\n        return {\n          condition: `(value ->> $${paramIndex})::numeric >= $${\n            paramIndex + 1\n          }`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$lt\":\n        params.push(key, operatorValue);\n        return {\n          condition: `(value ->> $${paramIndex})::numeric < $${paramIndex + 1}`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$lte\":\n        params.push(key, operatorValue);\n        return {\n          condition: `(value ->> $${paramIndex})::numeric <= $${\n            paramIndex + 1\n          }`,\n          newParamIndex: paramIndex + 2,\n        };\n      case \"$in\":\n        if (Array.isArray(operatorValue) && operatorValue.length > 0) {\n          const placeholders = operatorValue.map(\n            (_, i) => `$${paramIndex + 1 + i}`\n          );\n          params.push(key, ...operatorValue.map(String));\n          return {\n            condition: `value ->> $${paramIndex} = ANY(ARRAY[${placeholders.join(\n              \",\"\n            )}])`,\n            newParamIndex: paramIndex + 1 + operatorValue.length,\n          };\n        }\n        break;\n      case \"$nin\":\n        if (Array.isArray(operatorValue) && operatorValue.length > 0) {\n          const placeholders = operatorValue.map(\n            (_, i) => `$${paramIndex + 1 + i}`\n          );\n          params.push(key, ...operatorValue.map(String));\n          return {\n            condition: `value ->> $${paramIndex} != ALL(ARRAY[${placeholders.join(\n              \",\"\n            )}])`,\n            newParamIndex: paramIndex + 1 + operatorValue.length,\n          };\n        }\n        break;\n      case \"$exists\":\n        params.push(key);\n        return {\n          condition: operatorValue\n            ? `value ? $${paramIndex}`\n            : `NOT (value ? $${paramIndex})`,\n          newParamIndex: paramIndex + 1,\n        };\n      default:\n        // Unknown operator, ignore\n        break;\n    }\n    return { newParamIndex: paramIndex };\n  }\n}\n"],"mappings":";;;;AAGA,IAAa,eAAb,MAA0B;CACxB,OAAO,sBACL,QACA,QACA,YACiD;EACjD,MAAMA,aAAuB;EAC7B,IAAI,oBAAoB;AAExB,OAAK,MAAM,CAAC,KAAK,UAAU,OAAO,QAAQ,QACxC,KACE,OAAO,UAAU,YACjB,UAAU,QACV,CAAC,MAAM,QAAQ,QACf;GACA,MAAM,YAAY,OAAO,KAAK;GAC9B,MAAM,mBAAmB,UAAU,MAAM,OAAO,GAAG,WAAW;AAE9D,OAAI,iBAEF,MAAK,MAAM,CAAC,UAAU,kBAAkB,OAAO,QAAQ,QAAQ;IAC7D,MAAM,SAAS,KAAK,uBAClB,KACA,UACA,eACA,QACA;AAEF,QAAI,OAAO,WAAW;AACpB,gBAAW,KAAK,OAAO;AACvB,yBAAoB,OAAO;;;QAG1B;AAEL,eAAW,KAAK,aAAa,kBAAkB;AAC/C,WAAO,KAAK,KAAK,UAAU,GAAG,MAAM;AACpC,yBAAqB;;SAElB;AAEL,cAAW,KACT,cAAc,kBAAkB,MAAM,oBAAoB;AAE5D,UAAO,KAAK,KAAK,OAAO;AACxB,wBAAqB;;AAIzB,SAAO;GAAE;GAAY,eAAe;;;CAGtC,OAAe,uBACb,KACA,UACA,eACA,QACA,YAC+C;AAC/C,UAAQ,UAAR;GACE,KAAK;AACH,WAAO,KAAK,KAAK,OAAO;AACxB,WAAO;KACL,WAAW,cAAc,WAAW,MAAM,aAAa;KACvD,eAAe,aAAa;;GAEhC,KAAK;AACH,WAAO,KAAK,KAAK,OAAO;AACxB,WAAO;KACL,WAAW,cAAc,WAAW,OAAO,aAAa;KACxD,eAAe,aAAa;;GAEhC,KAAK;AACH,WAAO,KAAK,KAAK;AACjB,WAAO;KACL,WAAW,eAAe,WAAW,gBAAgB,aAAa;KAClE,eAAe,aAAa;;GAEhC,KAAK;AACH,WAAO,KAAK,KAAK;AACjB,WAAO;KACL,WAAW,eAAe,WAAW,iBACnC,aAAa;KAEf,eAAe,aAAa;;GAEhC,KAAK;AACH,WAAO,KAAK,KAAK;AACjB,WAAO;KACL,WAAW,eAAe,WAAW,gBAAgB,aAAa;KAClE,eAAe,aAAa;;GAEhC,KAAK;AACH,WAAO,KAAK,KAAK;AACjB,WAAO;KACL,WAAW,eAAe,WAAW,iBACnC,aAAa;KAEf,eAAe,aAAa;;GAEhC,KAAK;AACH,QAAI,MAAM,QAAQ,kBAAkB,cAAc,SAAS,GAAG;KAC5D,MAAM,eAAe,cAAc,KAChC,GAAG,MAAM,IAAI,aAAa,IAAI;AAEjC,YAAO,KAAK,KAAK,GAAG,cAAc,IAAI;AACtC,YAAO;MACL,WAAW,cAAc,WAAW,eAAe,aAAa,KAC9D,KACA;MACF,eAAe,aAAa,IAAI,cAAc;;;AAGlD;GACF,KAAK;AACH,QAAI,MAAM,QAAQ,kBAAkB,cAAc,SAAS,GAAG;KAC5D,MAAM,eAAe,cAAc,KAChC,GAAG,MAAM,IAAI,aAAa,IAAI;AAEjC,YAAO,KAAK,KAAK,GAAG,cAAc,IAAI;AACtC,YAAO;MACL,WAAW,cAAc,WAAW,gBAAgB,aAAa,KAC/D,KACA;MACF,eAAe,aAAa,IAAI,cAAc;;;AAGlD;GACF,KAAK;AACH,WAAO,KAAK;AACZ,WAAO;KACL,WAAW,gBACP,YAAY,eACZ,iBAAiB,WAAW;KAChC,eAAe,aAAa;;GAEhC,QAEE;;AAEJ,SAAO,EAAE,eAAe"}