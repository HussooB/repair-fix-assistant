{"version":3,"file":"ttl-manager.js","names":["core: DatabaseCore"],"sources":["../../../src/store/modules/ttl-manager.ts"],"sourcesContent":["import { DatabaseCore } from \"./database-core.js\";\n\n/**\n * Handles TTL (Time-To-Live) operations: expiration, cleanup, sweeping.\n */\nexport class TTLManager {\n  private sweepInterval?: NodeJS.Timeout;\n\n  constructor(private core: DatabaseCore) {}\n\n  start(): void {\n    if (this.sweepInterval) return; // Already running\n\n    const intervalMs =\n      (this.core.ttlConfig?.sweepIntervalMinutes || 60) * 60 * 1000;\n    this.sweepInterval = setInterval(() => {\n      this.sweepExpiredItems().catch((error) => {\n        console.error(\"Error during TTL sweep:\", error);\n      });\n    }, intervalMs);\n  }\n\n  stop(): void {\n    if (this.sweepInterval) {\n      clearInterval(this.sweepInterval);\n      this.sweepInterval = undefined;\n    }\n  }\n\n  async sweepExpiredItems(): Promise<number> {\n    return this.core.withClient(async (client) => {\n      const result = await client.query(`\n        DELETE FROM ${this.core.schema}.store \n        WHERE expires_at IS NOT NULL AND expires_at <= CURRENT_TIMESTAMP\n      `);\n      return result.rowCount || 0;\n    });\n  }\n}\n"],"mappings":";;;;AAKA,IAAa,aAAb,MAAwB;CACtB,AAAQ;CAER,YAAY,AAAQA,MAAoB;EAApB;;CAEpB,QAAc;AACZ,MAAI,KAAK,cAAe;EAExB,MAAM,cACH,KAAK,KAAK,WAAW,wBAAwB,MAAM,KAAK;AAC3D,OAAK,gBAAgB,kBAAkB;AACrC,QAAK,oBAAoB,OAAO,UAAU;AACxC,YAAQ,MAAM,2BAA2B;;KAE1C;;CAGL,OAAa;AACX,MAAI,KAAK,eAAe;AACtB,iBAAc,KAAK;AACnB,QAAK,gBAAgB;;;CAIzB,MAAM,oBAAqC;AACzC,SAAO,KAAK,KAAK,WAAW,OAAO,WAAW;GAC5C,MAAM,SAAS,MAAM,OAAO,MAAM;sBAClB,KAAK,KAAK,OAAO;;;AAGjC,UAAO,OAAO,YAAY"}