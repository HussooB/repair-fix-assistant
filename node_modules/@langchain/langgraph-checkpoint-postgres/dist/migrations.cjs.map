{"version":3,"file":"migrations.cjs","names":["getTablesWithSchema"],"sources":["../src/migrations.ts"],"sourcesContent":["import { getTablesWithSchema } from \"./sql.js\";\n\n/**\n * To add a new migration, add a new string to the list returned by the getMigrations function.\n * The position of the migration in the list is the version number.\n */\nexport const getMigrations = (schema: string) => {\n  const SCHEMA_TABLES = getTablesWithSchema(schema);\n  return [\n    `CREATE TABLE IF NOT EXISTS ${SCHEMA_TABLES.checkpoint_migrations} (\n    v INTEGER PRIMARY KEY\n  );`,\n    `CREATE TABLE IF NOT EXISTS ${SCHEMA_TABLES.checkpoints} (\n    thread_id TEXT NOT NULL,\n    checkpoint_ns TEXT NOT NULL DEFAULT '',\n    checkpoint_id TEXT NOT NULL,\n    parent_checkpoint_id TEXT,\n    type TEXT,\n    checkpoint JSONB NOT NULL,\n    metadata JSONB NOT NULL DEFAULT '{}',\n    PRIMARY KEY (thread_id, checkpoint_ns, checkpoint_id)\n  );`,\n    `CREATE TABLE IF NOT EXISTS ${SCHEMA_TABLES.checkpoint_blobs} (\n    thread_id TEXT NOT NULL,\n    checkpoint_ns TEXT NOT NULL DEFAULT '',\n    channel TEXT NOT NULL,\n    version TEXT NOT NULL,\n    type TEXT NOT NULL,\n    blob BYTEA,\n    PRIMARY KEY (thread_id, checkpoint_ns, channel, version)\n  );`,\n    `CREATE TABLE IF NOT EXISTS ${SCHEMA_TABLES.checkpoint_writes} (\n    thread_id TEXT NOT NULL,\n    checkpoint_ns TEXT NOT NULL DEFAULT '',\n    checkpoint_id TEXT NOT NULL,\n    task_id TEXT NOT NULL,\n    idx INTEGER NOT NULL,\n    channel TEXT NOT NULL,\n    type TEXT,\n    blob BYTEA NOT NULL,\n    PRIMARY KEY (thread_id, checkpoint_ns, checkpoint_id, task_id, idx)\n  );`,\n    `ALTER TABLE ${SCHEMA_TABLES.checkpoint_blobs} ALTER COLUMN blob DROP not null;`,\n  ];\n};\n"],"mappings":";;;;;;;AAMA,MAAa,iBAAiB,WAAmB;CAC/C,MAAM,gBAAgBA,gCAAoB;AAC1C,QAAO;EACL,8BAA8B,cAAc,sBAAsB;;;EAGlE,8BAA8B,cAAc,YAAY;;;;;;;;;;EAUxD,8BAA8B,cAAc,iBAAiB;;;;;;;;;EAS7D,8BAA8B,cAAc,kBAAkB;;;;;;;;;;;EAW9D,eAAe,cAAc,iBAAiB"}